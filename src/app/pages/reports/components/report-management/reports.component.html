<ba-card cardTitle="Reports {{userSubTitle}}">
    <div class="row">
        <div class="col-sm-4">
            <label>Start Date</label>
            <div class="input-group">
                <input class="form-control" [maxDate]="filter.todaysDate" name="dp" ngbDatepicker #d="ngbDatepicker" [(ngModel)]="filter.startDate"
                    disabled>
                <button class="input-group-addon" (click)="d.toggle()" type="button">
                    <i class="ion-calendar"></i>
                </button>
            </div>
        </div>
        <div class="col-sm-4">
            <label>End Date</label>
            <div class="input-group">
                <input class="form-control" name="dp" ngbDatepicker #d1="ngbDatepicker" [(ngModel)]="filter.endDate" disabled>
                <button class="input-group-addon" (click)="d1.toggle()" type="button">
                    <i class="ion-calendar"></i>
                </button>
            </div>
        </div>
        <div class="col-sm-4 head-button-container-for-report">
            <div class="row">
                <div class="col-sm-3">
                    <div class="row padding">
                        <label>Select Report</label>
                    </div>
                </div>
                <div class="col-sm-9">
                    <div class="row">
                        <select class="form-control" [(ngModel)]="filter.reportType" (ngModelChange)="reportTypeChangeHandler()">
                            <option value="AS" *ngIf="!user.IsDistributor">Asset Scan</option>
                            <option value="DR" *ngIf="!user.IsDistributor">Deposit Register</option>
                            <option value="DST" *ngIf="user.Role.RoleID < 3">Distributor Statement</option>
                            <option value="IOA" *ngIf="!user.IsDistributor">Inventory on Arrival</option>
                            <option value="SRT">Sales</option>
                            <option value="TR" *ngIf="!user.IsDistributor">Ticket Details</option>
                            <option value="SR">Trip Details</option>
                            <option value="RS">Unit Summary</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-4" [hidden]="!user.IsDistributor||filter.reportType==='SRT'||filter.reportType==='DST'||filter.reportType==='RS'">
            <label>Select Customer Source</label>
            <select class="form-control" [(ngModel)]='filter.custType' (ngModelChange)="customerTypeChange()">
                <option [value]="0">All Customers</option>
                <option [value]="101">RI Customers</option>
                <option [value]="103">External Customers</option>
            </select>
        </div>
        <div class="col-md-1 text-right head-button-container">
            <button class="btn btn-danger button-top-margin" (click)="updateLink(filter.reportType)">View Report</button>
        </div>
    </div>
    <div [ngClass]="{'row top-margin':filter.reportType === 'SR','row top-margin no-margin':filter.reportType !== 'SR'}">
        <div class="col-sm-12">
            <div class="row">
                <div class="col-sm-3 div-border" *ngIf="filter.reportType === 'SR'">
                    <span class="col-sm-4 local-padding-eater">
                        <label class="top-margin">Ticket Type</label>
                    </span>
                    <span class="col-sm-4 local-padding-eater left-margin">
                        <input type="radio" name="ticketType" value="regular" [(ngModel)]="filter.ticketType" class="top-margin" checked>
                        <label class="top-margin">
                            <b>Regular</b>
                        </label>
                    </span>
                    <span class="col-sm-4 local-padding-eater left-margin">
                        <input type="radio" name="ticketType" value="paper" [(ngModel)]="filter.ticketType" class="top-margin">
                        <label class="top-margin">
                            <b>Paper</b>
                        </label>
                    </span>
                </div>
                <div [ngClass]="{'col-sm-9 div-border1':true}">
                    <div class="row" style="padding-top:2px;">
                        <div class="col-sm-3" [hidden]="filter.reportType === 'DR'||filter.reportType ==='AS'||filter.reportType==='IOA'">
                            <div class="row">
                                <div class="col-sm-4">
                                    <input type="radio" name="userType" value="internal" [(ngModel)]="filter.userType" (ngModelChange)="userTypeChangeHandler()"
                                        [disabled]="user.IsDistributor || filter.reportType === 'DST'">
                                    <label class="top-margin">
                                        <b>RI</b>
                                    </label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="radio" name="userType" [disabled]="filter.reportType === 'DR'" value="external" [(ngModel)]="filter.userType"
                                        (ngModelChange)="userTypeChangeHandler()">
                                    <label class="top-margin">
                                        <b>Distributor</b>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div [ngClass]="{'col-sm-9':true}">
                            <div class="row">
                                <ng-container *ngIf="filter.userType === 'internal'">
                                    <div class="col-sm-2">
                                        <label class="top-margin pull-right">
                                            <b>Branch</b>
                                        </label>
                                    </div>
                                    <div class="col-sm-4">
                                        <reddy-select [options]="branches" [(selected)]="filter.branch" (selectedChange)="branchChangeHandler(filter.branch)"></reddy-select>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="filter.userType === 'external'">
                                    <div class="col-sm-2">
                                        <label class="top-margin pull-right">
                                            <b>Dist/Copacker</b>
                                        </label>
                                    </div>
                                    <div class="col-sm-4">
                                        <reddy-select [disabled]="user.IsDistributor" [options]="distributors" [(selected)]="filter.distributor" (selectedChange)="distributorChangeHandler();getAllCustomers(filter.distributor)"></reddy-select>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="filter.userType === 'internal'">
                                    <div class="col-sm-2">
                                        <label class="top-margin pull-right">
                                            <b>Driver</b>
                                        </label>
                                    </div>
                                    <div class="col-sm-4">
                                        <reddy-select [options]="drivers" [(selected)]="filter.driver"></reddy-select>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="filter.userType === 'external'">
                                    <div class="col-sm-2" [hidden]="filter.reportType === 'DST'">
                                        <label class="top-margin pull-right">
                                            <b>Driver</b>
                                        </label>
                                    </div>
                                    <div class="col-sm-4" [hidden]="filter.reportType === 'DST'">
                                        <reddy-select [options]="driversofDist" [(selected)]="filter.driver"></reddy-select>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3" [hidden]="filter.reportType==='DST'||filter.reportType==='RS'">
                    <div class="row" [ngStyle]="{'padding': filter.reportType === 'SR'?'10px 0':''}">
                        <div class="col-sm-4">
                            <label class="top-margin pull-right">
                                <b>Customer</b>
                            </label>
                        </div>
                        <div class="col-sm-8">
                            <reddy-select [options]="customers" [(selected)]="filter.custID"></reddy-select>
                        </div>
                        <div style='margin-left: 120px;'>
                            <a>
                                <img [hidden]='!showSpinner' src="assets/reddyIce/spinner.gif " width='25px'>
                            </a>
                        </div>
                        <!-- <div *ngIf="(customers.length == 0 && !showSpinner)" style='margin-left: 100px;margin-top:10px;'>
                            No data found
                        </div> -->
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div id='loader' *ngIf="viewReport" style='text-align:center;position: absolute;z-index: -1;left: 40%;top: 40%;'>
        <a>
            <img src="assets/reddyIce/spinner.gif " width='25px'>
        </a>
    </div>
    <div class="top-margin" style="z-index: 999">
        <iframe *ngIf="viewReport" width="100%" height="400px" style="border:1px solid rgba(0, 0, 0, 0.1)" [src]='linkRpt'></iframe>
    </div>
</ba-card>