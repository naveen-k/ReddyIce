<ba-card cardTitle="Ticket">
    <div class="row">
        <div class="col-sm-12">
            <div class="pull-right">
                <button class="btn btn-danger" [hidden]="ticket.TicketStatusID == 24 || isReadOnly">Approve</button>
                <button class="btn btn-danger buttonMargin" [disabled]="disablePodButton" onclick="document.getElementById('file').click()"
                    [hidden]="isReadOnly">
                    Upload POD
                </button>
                <input id="file" type="file" (change)="onFileUpload($event)" style="display:none" accept="image/png" />
                <button class="btn btn-danger buttonMargin" (click)="saveTicket()" [hidden]="isReadOnly"
                [disabled]="!isFormDirty">
                    Save
                </button>
                <button class="btn btn-danger buttonMargin" (click)="saveTicket()" [hidden]="isReadOnly"
                [disabled]="!isFormDirty">
                    Submit
                </button>
                <!-- <button class="btn btn-default buttonMargin" [routerLink]="['../list']">Cancel</button> -->
                <button class="btn btn-default buttonMargin" (click)="onCancelClick()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="form-group row" style="margin-top: 20px;">
        <label for="example-text-input" class="col-sm-2 col-form-label">Branch</label>
        <div class="col-sm-4">
            <select class="form-control" name="branch" [(ngModel)]="ticket.BranchID" (ngModelChange)="branchChangeHandler()" [disabled]="isReadOnly">
                <option *ngFor="let branch of branches" [ngValue]="branch.BranchID"> {{branch.BranchID}} - {{branch.BranchName}} </option>
            </select>
        </div>
        <label for="example-text-input" class="col-sm-2 col-form-label">Ticket Type</label>
        <div class="col-sm-4">
            <label *ngFor="let tType of ticketTypes?.CustomerType" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                <input type="radio" name="ticketType" [value]="tType.ID" [(ngModel)]="ticket.TicketTypeID" (ngModelChange)="ticketChangeHandler()" [attr.disabled]="isReadOnly">
                <span>{{tType.Value}}</span>
            </label>
        </div>
    </div>
    <div class="form-group row">
        <label for="example-text-input" class="col-sm-2 col-form-label">Date</label>
        <div class="col-sm-4 input-group" style="margin-bottom:0px;">
            <input class="form-control" [(ngModel)]="ticket.DeliveryDate" placeholder="yyyy-mm-dd" name="dp" ngbDatepicker #d="ngbDatepicker"
                [disabled]="isReadOnly">
            <button class="input-group-addon" (click)="d.toggle()" type="button" [disabled]="isReadOnly">
                <i class="ion-calendar"></i>
            </button>
        </div>
        <label for="example-text-input" class="col-sm-2 col-form-label">Type</label>
        <div class="col-sm-4">
            <label *ngFor="let sType of ticketSubTypes" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                <input type="radio" name="type" [value]="sType.ID" [(ngModel)]="ticket.SaleTypeID" (ngModelChange)="typeChangeHandler()">
                <span>{{sType.Value}}</span>
            </label>
        </div>
    </div>
    <div class="form-group row">
        <label for="example-text-input" class="col-sm-2 col-form-label">Customer Name</label>
        <div class="col-sm-4">
            <select class="form-control" name="customer" [(ngModel)]="ticket.CustomerID" (ngModelChange)="customerChangeHandler()" [disabled]="isReadOnly">
                <option *ngFor="let customer of customers" [ngValue]="customer.CustomerId"> {{customer.CustomerName}} </option>
            </select>
        </div>
        <label [hidden]="!modes" for="example-text-input" class="col-sm-2 col-form-label">Mode</label>
        <div class="col-sm-4" [hidden]="!modes">
            <label *ngFor="let mType of modes" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                <input type="radio" name="mode" [value]="mType.ID" [(ngModel)]="ticket.Mode">
                <span>{{mType.Value}}</span>
            </label>
        </div>
    </div>
    <div class="form-group row">
        <label for="example-text-input" class="col-sm-2 col-form-label">Driver</label>
        <div class="col-sm-4">
            <select class="form-control" name="customer" [(ngModel)]="ticket.UserId" [disabled]="isReadOnly">
                <option *ngFor="let driver of drivers" [ngValue]="driver.UserId"> {{driver.FirstName}} {{driver.LastName}} </option>
            </select>
        </div>
        <label for="example-text-input" class="col-sm-2 col-form-label">POD</label>
        <div class="col-sm-4">
            <label class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                <input type="radio" name="pod" id="podRadio1" value="received" (click)="isPodReceived(1)">
                <span>Received</span>
            </label>
            <label class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                <input type="radio" name="pod" id="podRadio2" value="notReceived" checked (click)="isPodReceived(2)">
                <span>Not-Received</span>
            </label>
        </div>
    </div>
    <div class="form-group row">
        <label for="example-text-input" class="col-sm-2 col-form-label">Cash Amount</label>
        <div class="col-sm-2">
            <input type="number" class="form-control" [(ngModel)]="ticket.CashAmount" placeholder="Cash Amount" [disabled]="ticket.SaleTypeID == 23 || isReadOnly">
        </div>
        <label for="example-text-input" class="col-sm-1 col-form-label">Check#</label>
        <div class="col-sm-3">
            <input type="text" class="form-control" [(ngModel)]="ticket.CheckNumber" placeholder="Check Number" (blur)="checkNumberChangeHandler()"
                name="CheckNumber" #CheckNumber="ngModel" required [disabled]="ticket.SaleTypeID == 23 || isReadOnly">
            <div *ngIf="CheckNumber.invalid && (CheckNumber.dirty || CheckNumber.touched)" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div *ngIf="CheckNumber.errors.required" class="custom-tooltip bottom">Check number is required</div>
            </div>
            <div *ngIf="checkMinMaxLength" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div class="custom-tooltip bottom">Should not be more than 20 digits</div>
            </div>
        </div>
        <label for="example-text-input" class="col-sm-2 col-form-label">Check Amount</label>
        <div class="col-sm-2">
            <input type="number" class="form-control" [(ngModel)]="ticket.CheckAmount" placeholder="Check Amount" [disabled]="ticket.SaleTypeID == 23 || isReadOnly">
        </div>
    </div>
    <div class="form-group row">
        <label for="example-text-input" class="col-sm-2 col-form-label">Ticket#</label>
        <div class="col-sm-4">
            <input type="number" min="1" onKeyPress="if(this.value.length==10) return false;" class="form-control" [(ngModel)]="ticket.TicketNumber"
                id="TicketNumber" placeholder="Ticket Number" (blur)="ticketNumberChangeHandler()" name="TicketNumber" #TicketNumber="ngModel"
                required [disabled]="isReadOnly">
            <div *ngIf="TicketNumber.invalid && (TicketNumber.dirty || TicketNumber.touched)" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div *ngIf="TicketNumber.errors.required" class="custom-tooltip bottom">Ticket number is required</div>
            </div>
            <div *ngIf="isTicketNumberExist" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div class="custom-tooltip bottom">Ticket Number already in use</div>
            </div>
            <div *ngIf="containsCharacters" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div class="custom-tooltip bottom">Ticket number cannot contain characters</div>
            </div>
            <div *ngIf="ticketMinMaxLength" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div class="custom-tooltip bottom">Ticket number should be 4-10 digits long only</div>
            </div>
        </div>
        <label for="example-text-input" class="col-sm-2 col-form-label">PO#</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" [(ngModel)]="ticket.PONumber" [disabled]="isReadOnly" placeholder="PO Number" (blur)="poNumberChangeHandler()"
                name="PONumber" #PONumber="ngModel" required numberOnly>
            <div *ngIf="PONumber.invalid && (PONumber.dirty || PONumber.touched)" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div *ngIf="PONumber.errors.required" class="custom-tooltip bottom">PO number is required</div>
            </div>
            <div *ngIf="poContainsCharacters" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div class="custom-tooltip bottom">PO number should be alphanumeric</div>
            </div>
            <div *ngIf="poMinMaxLength" class="error-message">
                <i class="ion-android-alert showError"></i>
                <div class="custom-tooltip bottom">PO number should be 4-20 digits long only</div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="pull-right">
                <!-- <button class="btn btn-danger">Add Machine</button> -->
                <button class="btn btn-danger buttonMargin" (click)="addProductRow()" [hidden]="isReadOnly">Add Product</button>
            </div>
        </div>
    </div>
    <br>

    <!-- DSD Table begins -->
    <div class="row" *ngIf="ticket.TicketTypeID == 20">
        <div class="col-sm-12">
            <table class="table table-condensed">
                <thead class="tableHeader">
                    <th>Product</th>
                    <th>Unit Price</th>
                    <th>Unit#</th>
                    <th>Total Amount</th>
                    <th>Action</th>
                </thead>
                <tbody>
                    <tr *ngFor="let tdetail of ticket?.TicketDetail">
                        <td>
                            <select class="form-control" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail)"
                                [disabled]="isReadOnly">
                                <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID"> 
                                    {{pdetail.DisplayName}} </option>    
                            </select>
                        </td>
                        <td> {{tdetail.productSelected?.Price | currency:'USD':true:'2.2-4'}}</td>
                        <td>
                            <input type="number" class="form-control" [(ngModel)]="tdetail.Quantity" (blur)="unitChangeHandler(tdetail);" [disabled]="isReadOnly">
                        </td>
                        <td>{{tdetail.totalAmount | currency:'USD':true:'2.2-4'}}</td>
                        <td>
                            <a href="javascript:void();" (click)="deleteProductHandler(tdetail)"><i class="ion-trash-a"></i></a>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2"></td>
                        <td><b>{{ticket.tempTotalUnit}}</b></td>
                        <td><b>{{ticket.TotalSale | currency:'USD':true:'2.2-4'}}</b></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- DSD Table ends -->

    <!-- Meter Reading table -->
    <div class="row" *ngIf="ticket.TicketTypeID == 22 && ticket.Mode == 22">
        <div class="col-sm-12">
            <table class="table table-condensed">
                <thead class="tableHeader">
                    <th>Machine</th>
                    <th>Unit Price</th>
                    <th>Previous Reading</th>
                    <th>Current Reading</th>
                    <th>Total Amount</th>
                    <th>Action</th>
                </thead>
                <tbody>
                    <tr *ngFor="let tdetail of ticket?.TicketDetail">
                        <td>
                            <select class="form-control" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail)"
                                [disabled]="isReadOnly">
                                <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID"> 
                                    {{pdetail.DisplayName}} </option>    
                            </select>
                        </td>
                        <td> {{tdetail.productSelected?.Price | currency:'USD':true:'2.2'}}</td>
                        <td>
                            <input type="text" minValue class="form-control" [(ngModel)]="tdetail.StartMeterReading" (blur)="readingChangeHandler(tdetail);"
                                [disabled]="isReadOnly">
                        </td>
                        <td>
                            <input type="text" [minValue]="tdetail.StartMeterReading" class="form-control" [(ngModel)]="tdetail.EndMeterReading" (blur)="readingChangeHandler(tdetail);"
                                [disabled]="isReadOnly" [min]="tdetail.StartMeterReading">
                        </td>
                        <td>{{tdetail.totalAmount | currency:'USD':true:'2.2-4'}}</td>
                        <td>
                            <a href="javascript:void();" (click)="deleteProductHandler(tdetail)"><i class="ion-trash-a"></i></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Inventory table -->
    <div class="row" *ngIf="ticket.TicketTypeID == 22 && ticket.Mode == 23">
        <div class="col-sm-12">
            <table class="table table-condensed">
                <thead class="tableHeader">
                    <th>Machine</th>
                    <th>Unit Price</th>
                    <th>Delivered Bags</th>
                    <th>Current Inventory</th>
                    <th>Damaged Bags</th>
                    <th>Action</th>
                </thead>
                <tbody>
                    <tr *ngFor="let tdetail of ticket?.TicketDetail">
                        <td>
                            <select class="form-control" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail)"
                                [disabled]="isReadOnly">
                                <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID"> 
                                    {{pdetail.DisplayName}} </option>    
                            </select>
                        </td>
                        <td> {{tdetail.productSelected?.Price | currency:'USD':true:'2.2-4'}}</td>
                        <td>
                            <input type="number" class="form-control" [(ngModel)]="tdetail.DeliveredBags" (blur)="unitChangeHandler(tdetail);" [disabled]="isReadOnly">
                        </td>
                        <td>
                            <input type="number" class="form-control" [(ngModel)]="tdetail.CurrentInventory" (blur)="unitChangeHandler(tdetail);" [disabled]="isReadOnly">
                        </td>
                        <td>
                            <input type="number" class="form-control" [(ngModel)]="tdetail.DamagedBags" (blur)="unitChangeHandler(tdetail);" [disabled]="isReadOnly">
                        </td>
                        <td>
                            <a href="javascript:void();" (click)="deleteProductHandler(tdetail)"><i class="ion-trash-a"></i></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!-- PBM Table ends -->

    <!-- PBS Table begins -->
    <div class="row" *ngIf="ticket.TicketTypeID == 21">
        <div class="col-sm-12">
            <table class="table table-condensed">
                <thead class="tableHeader">
                    <th>Product</th>
                    <th>Unit Price</th>
                    <th>Current Inventory</th>
                    <th>Delivered Bags</th>
                    <th>Total Amount</th>
                    <th>Action</th>
                </thead>
                <tbody>
                    <tr *ngFor="let tdetail of ticket?.TicketDetail">
                        <td>
                            <select class="form-control" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail)"
                                [disabled]="isReadOnly">
                                <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID"> 
                                    {{pdetail.DisplayName}} </option>    
                            </select>
                        </td>
                        <td> {{tdetail.productSelected?.Price | currency:'USD':true:'2.2-4'}}</td>
                        <td>
                            <input type="number" class="form-control" [(ngModel)]="tdetail.CurrentInventory" (blur)="bagsChangeHandler(tdetail);" [disabled]="isReadOnly">
                        </td>
                        <td>
                            <input type="number" class="form-control" [(ngModel)]="tdetail.DeliveredBags" (blur)="bagsChangeHandler(tdetail);" [disabled]="isReadOnly">
                        </td>
                        <td>{{tdetail.totalAmount | currency:'USD':true:'2.2-4'}}</td>
                        <!-- <td>{{tdetail.totalAmount | currency:'USD':true:'2.2-4'}}</td> -->
                        <td>
                            <a href="javascript:void();" (click)="deleteProductHandler(tdetail)"><i class="ion-trash-a"></i></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- PBS Table ends -->


    <div class="row dummyMarginTop">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-8">
                    <b>Total Sale</b>
                </div>
                <div class="col-md-4">
                    <b>{{ticket.TotalSale | currency:'USD':true:'2.2-4'}}</b>
                </div>
            </div>
            <br>
            <!-- <div class="row">
                <div class="col-md-4">
                    <b>Store Credit</b>
                </div>
                <div class="col-md-4">
                    <input type="text" class="form-control">
                </div>
                <div class="col-md-4">
                    <b>-$5.00</b>
                </div>
            </div>
            <br> -->
            <div class="row">
                <div class="col-md-8">
                    <b>Tax</b>
                </div>
                <div class="col-md-4">
                    <b>{{customer?.Tax}}</b>
                </div>
            </div>
        </div>
        <div class="col-md-6 createNewTicket">
            <div class="row">
                <div class="col-md-4">
                    <b>Total Amount</b>
                </div>
                <div class="col-md-8">
                    <b>{{ticket.TotalAmount | currency:'USD':true:'2.2'}}</b>
                </div>
            </div>
        </div>
    </div>
</ba-card>