<div [hidden]="!overlayStatus" style="top:65px;bottom:0;left:0;right:0;height:calc(100% - 65px); opacity:0.5;background:gray;z-index:999;position:absolute;">
    <div style="margin:auto;position:absolute;top:50%;left:50%;">
        <img src="assets/reddyIce/spinner.gif " width='25px'>
    </div>
</div>

<ba-card cardTitle="{{pageTitle}} {{userSubTitle}}" id="newTicket">
    <img src="assets/reddyIce/submitTicket.png" *ngIf="!activatedRoute.snapshot.params.ticketId || ticket.TicketStatusID == 24 || ticket.TicketStatusID == 23"
        width="18" class="newTicketTitleStatusIcon">
    <img src="assets/reddyIce/approveTicket.png" *ngIf="ticket.TicketStatusID == 25" width="15" class="newTicketTitleStatusIcon">

    <div class="row">
        <div class="col-sm-12">
            <div class="pull-right head-button-container">
                <button class="btn btn-danger buttonMargin" (click)="onCancelClick()">Back</button>
                <button class="btn btn-danger" style="margin-left:10px;" (click)="approveTicket()" [hidden]="(!ticket.TicketID || ticket.TicketStatusID == 23 || ticket.TicketStatusID == 25) || tripMode === true">
                    Approve
                </button>
                <input id="file" type="file" (change)="onFileUpload($event)" style="display:none" accept="image/png,image/jpeg,application/pdf"
                />
                <button class="btn btn-danger buttonMargin" [hidden]="tripMode || ticket.TicketStatusID !== 23" [disabled]="ticket.TicketStatusID !== 23"
                    (click)="deleteTicket()">
                    Delete
                </button>
                <button class="btn btn-danger buttonMargin" (click)="preSaveTicket();" [hidden]="isReadOnly" [disabled]="ticket.IsEDITicket !==true &&  (!isFormDirty || isSubmited)">
                    Submit
                </button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <fieldset>
                <legend>Select Driver</legend>
                <div class="row">
                    <label for="example-text-input" class="col-sm-4 col-form-label">Type:</label>
                    <div [hidden]="isReadOnly || tripMode" class="col-sm-7">
                        <label class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input [disabled]="user.IsDistributor || !!ticket.TicketID" type="radio" name="driverType" [value]="false" [(ngModel)]="ticket.isUserTypeDistributor"
                                (ngModelChange)="userTypeChangeHandler();isFormDirty=true;">
                            <span>RI Driver</span>
                        </label>
                        <label class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input [disabled]="user.IsDistributor || !!ticket.TicketID || user.Role.RoleID == 3 || user.Role.RoleID == 5 || user.Role.RoleID == 7" type="radio" name="driverType" [value]="true"
                                [(ngModel)]="ticket.isUserTypeDistributor" (ngModelChange)="userTypeChangeHandler();isFormDirty=true;">
                            <span>Distributor/CoPacker</span>
                        </label>
                    </div>
                    <!--Hack for displaying disabled in case of read only mode-->
                    <div [hidden]="!isReadOnly && !tripMode" class="col-sm-7">
                        <label class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input [disabled]="true" type="radio" name="driverType1" [value]="false" [(ngModel)]="ticket.isUserTypeDistributor">
                            <span>RI Driver</span>
                        </label>
                        <label class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input [disabled]="true" type="radio" name="driverType1" [value]="true" [(ngModel)]="ticket.isUserTypeDistributor">
                            <span>Distributor/CoPacker</span>
                        </label>
                    </div>
                </div>
                <div class="row" [hidden]="ticket.isUserTypeDistributor">
                    <label for="example-text-input" class="col-sm-4 col-form-label">
                        Business Unit:
                        <sup style="color:red;">*</sup>
                    </label>
                    <div class="col-sm-7">
                        <reddy-select [(selected)]="ticket.BranchID" (selectedChange)="branchChangeHandler();isFormDirty=true;" [disabled]="ticket.TicketID || tripMode"
                            [options]="branches"></reddy-select>
                    </div>
                </div>
                <div class="row" [hidden]="ticket.isUserTypeDistributor">
                    <label for="example-text-input" class="col-sm-4 col-form-label">
                        Driver:
                        <sup style="color:red;">*</sup>
                    </label>
                    <div class="col-sm-7">
                        <!-- <select [disabled]="ticketId" class="form-control" name="customer" [(ngModel)]="ticket.UserID" [disabled]="isReadOnly || tripMode"
                            (ngModelChange)="listFilter.UserId = +ticket.UserID;isFormDirty=true">
                            <option [ngValue]="-1" selected style="display:none;">Select Driver</option>
                            <option *ngFor="let driver of drivers" [ngValue]="driver.UserId"> {{driver.FirstName}} {{driver.LastName}} </option>
                        </select> -->
                        <reddy-select [disabled]="ticketId || isReadOnly || tripMode" [options]="drivers" [(selected)]="ticket.UserID" (selectedChange)="listFilter.UserId = +ticket.UserID;isFormDirty=true"></reddy-select>  
                    </div>
                </div>
                <div class="row" [hidden]="!ticket.isUserTypeDistributor">
                    <label for="example-text-input" class="col-sm-4 col-form-label">Distributor/CoPacker:</label>
                    <div class="col-sm-7">
                        <reddy-select [(selected)]="ticket.DistributorCopackerID" (selectedChange)="distributorChangeHandler();isFormDirty=true;"
                            [disabled]="user.IsDistributor || isReadOnly" [options]="distributors"></reddy-select>
                    </div>
                </div>
            </fieldset>
        </div>
        <div class="col-sm-6">
            <div class="row">
                <label for="example-text-input" class="col-sm-3 col-form-label">Delivery Date:</label>
                <div class="col-sm-5 input-group">
                    <date-picker [minDate]="date.minDate" [maxDate]="date.maxDate" [(dateModel)]="ticket.DeliveryDate" (dateModelChange)="isFormDirty=true;" [disabled]="isReadOnly"></date-picker>
                </div>
            </div>
            <div class="row" [style.visibility]="(ticket.CustomerType == 21 ||(ticket.CustomerType == 22 && !ticket.IsSaleTicket))?'hidden':'visible'">
                <label for="example-text-input" class="col-sm-3 col-form-label">Type:</label>
                <div class="col-sm-7">
                    <label [hidden]="isReadOnly" *ngFor="let sType of ticketSubTypes" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                        <input [disabled]="(ticket.CustomerType == 22 && !!ticket.TicketID) || ticket.IsEDITicket == true" type="radio" name="type" [value]="sType.ID" [(ngModel)]="ticket.TicketTypeID"
                            (ngModelChange)="typeChangeHandler();isFormDirty=true;">
                        <span>{{sType.Value}}</span>
                    </label>
                    <!--Hack for displaying disabled in case of read only mode-->
                    <label [hidden]="!isReadOnly" *ngFor="let sType of ticketSubTypes" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                        <input [disabled]="ticket.CustomerType == 22 && !!ticket.TicketID || ticket.IsEDITicket == true" type="radio" name="type1" [value]="sType.ID" [(ngModel)]="ticket.TicketTypeID"
                            [disabled]="true">
                        <span>{{sType.Value}}</span>
                    </label>
                </div>
            </div>
            <div  class="row" *ngIf="ticket.IsEDITicket == true && (ticket.TicketReferenceId != null && ticket.TicketReferenceId != '')">
                <label for="example-text-input" class="col-sm-3 col-form-label">Ticket Reference&nbsp;#:</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" [(ngModel)]="ticket.TicketReferenceId" [disabled]="true" 
                    name="TicketReferenceId" #TicketReferenceId="ngModel">
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <fieldset>
                <legend>Select Customer</legend>
                <div class="row">
                    <label for="example-text-input" class="col-sm-4 col-form-label">Customer Type:</label>
                    <div class="col-sm-8">
                        <label [hidden]="isReadOnly || ticket.TicketID" *ngFor="let tType of ticketTypes?.CustomerType" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input type="radio" name="ticketType" [value]="tType.ID" [(ngModel)]="ticket.CustomerType" (ngModelChange)="customerTypeChangeHandler();isFormDirty=true;">
                            <span>{{tType.Value}}</span>
                        </label>
                        <label [hidden]="!ticket.TicketID" *ngFor="let tType of ticketTypes?.CustomerType" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input type="radio" name="ticketType1" [value]="tType.ID" [(ngModel)]="ticket.CustomerType" [disabled]="true">
                            <span>{{tType.Value}}</span>
                        </label>
                    </div>
                </div>
                <div class="row">
                    <label for="example-text-input" class="col-sm-4 col-form-label">
                        Customer Name:
                        <sup style="color:red;">*</sup>
                    </label>
                    <div class="col-sm-6">
                        <ng-template #rt let-r="result" let-t="term">
                            {{ r.CustomerNumber}} - {{ r.CustomerName}}
                        </ng-template>
                        <input id="typeahead-basic" type="text" class="form-control" [(ngModel)]="ticket.Customer" [ngbTypeahead]="search" [resultTemplate]="rt"
                            placeholder="Search Customer" [inputFormatter]="inputFormatter" (selectItem)="customerChangeHandler($event);isFormDirty=true;"
                            [disabled]="ticket.TicketID" [editable]="false" />
                    </div>
                    <label [hidden]="!customer || !ticket.Customer || ticket.CustomerType == 21 || ticket.CustomerType == 22" class="col-sm-2 paymentType">
                        {{customer?.PaymentType===19?'Charge':'Cash'}}
                    </label>
                </div>
                <div class="row" [hidden]="!modes || !modes.length">
                    <label for="example-text-input" class="col-sm-4 col-form-label">Mode:</label>
                    <div class="col-sm-8">
                        <label [hidden]="isReadOnly || ticket.TicketID" *ngFor="let mType of modes" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input type="radio" name="mode" [value]="mType.ID" [(ngModel)]="ticket.IsSaleTicket" (ngModelChange)="modeChangeHandler(); isFormDirty=true;">
                            <span>{{mType.Value}}</span>
                        </label>

                        <label [hidden]="!isReadOnly && !ticket.TicketID" *ngFor="let mType of modes" class="radioItem radio-inline custom-radio nowrap radioButtonMargin">
                            <input type="radio" name="mode1" [value]="mType.ID" [(ngModel)]="ticket.IsSaleTicket" [disabled]="true">
                            <span>{{mType.Value}}</span>
                        </label>
                    </div>
                </div>
            </fieldset>
        </div>
        <div class="col-sm-6">
            <div class="row" [hidden]="ticket.CustomerType==21">
                <label for="example-text-input" class="col-sm-3 col-form-label">POD:</label>
                <div [hidden]="isReadOnly" class="col-sm-9" *ngIf="!isDownloadable" style="padding-top:5px;">
                    <!-- <a href="javscript:void();" onclick="document.getElementById('file').click()">
                        <span>Upload</span>
                    </a> -->
                    <div class="btn btn-link uploadLink" onclick="document.getElementById('file').value = '';document.getElementById('file').click();">
                        <span>Upload</span>
                    </div>
                </div>
                <div [hidden]="!isReadOnly" class="col-sm-9" *ngIf="!isDownloadable" style="padding-top:5px;">
                    <span>NA</span>
                </div>
                <div class="col-sm-9" *ngIf="isDownloadable">
                    <label for="example-text-input" style="cursor:pointer;" (click)="downloadPODImage(ticket.PODImageID)" class="col-form-label">
                        <span title="Download POD Image">
                            <i class="icon ion-arrow-down-c"></i>
                        </span>
                        <u> Download</u>
                    </label>
                    <label (click)="deletePODImage(ticket.PODImageID, ticket.TicketID)" style="cursor:pointer" [hidden]="isReadOnly" *ngIf="ticket.PODImageID && !ticket.Customer.ChainID"
                        title="Delete POD Image">
                        <i class="icon ion-android-delete"></i>
                    </label>
                    <label onclick="document.getElementById('file').click()" style="cursor:pointer" [hidden]="isReadOnly" *ngIf="ticket.PODImageID && ticket.Customer.ChainID"
                        title="Replace POD Image">
                        <i class="icon ion-ios-loop-strong"></i>
                    </label>
                </div>
            </div>
            <div class="row">
                <label for="example-text-input" class="col-sm-3 col-form-label">
                    Ticket#:
                    <sup style="color:red;">*</sup>
                </label>
                <div class="col-sm-7">
                    <input type="text" [disabled]="ticketId" numberOnly oninput="validity.valid||(value='');" onKeyPress="if(this.value.length==10) return false;"
                        class="form-control" [(ngModel)]="ticket.TicketNumber" id="TicketNumber" placeholder="Ticket Number"
                        (blur)="ticketNumberChangeHandler()" name="TicketNumber" (ngModelChange)="isFormDirty=true;" #TicketNumber="ngModel"
                        required [disabled]="isReadOnly">
                </div>
            </div>
            <div class="row" [hidden]="ticket.CustomerType==21">
                <label for="example-text-input" class="col-sm-3 col-form-label">
                    PO#:
                    <!-- <sup style="color:red;">*</sup> -->
                </label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" [(ngModel)]="ticket.PONumber" [disabled]="isReadOnly" placeholder="PO Number" (blur)="poNumberChangeHandler()"
                        name="PONumber" #PONumber="ngModel" required (ngModelChange)="isFormDirty=true;">
                    <!-- <div *ngIf="poContainsCharacters" class="error-message">
                        <i class="ion-android-alert showError"></i>
                        <div class="custom-tooltip bottom">PO number should be alphanumeric</div>
                    </div>
                    <div *ngIf="poMinMaxLength" class="error-message">
                        <i class="ion-android-alert showError"></i>
                        <div class="custom-tooltip bottom">PO number should be 4-20 digits long only</div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-9">
            <div class="border">
                <div class="row padding tablePanel">
                    <div class="col-sm-9 col-form-label card-title">
                        <span>List of Products</span>
                    </div>
                    <div class="col-sm-3">
                        <button class="btn btn-danger pull-right" (click)="addProductRow()" [hidden]="isReadOnly" [disabled]="!(branches && ticket.Customer)">Add Product</button>
                    </div>
                </div>
                <div class="row padding">
                    <div class="col-sm-12 col-form-label">
                        <!-- DSD Table begins -->
                        <div class="row" *ngIf="ticket.CustomerType == 20">
                            <div class="col-sm-12">
                                <table class="table table-condensed">
                                    <thead class="mttableHeader">
                                        <th>Product</th>
                                        <th class="textAlignRight">Price</th>
                                        <th class="textAlignRight">Quantity</th>
                                        <th class="textAlignRight">Amount</th>
                                        <th class="textAlignCenter" [hidden]="isReadOnly">Action</th>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let tdetail of ticket?.TicketProduct;let i = index">
                                            <td id="prodDSD" *ngIf="(customer?.productdetail !== null) && (customer?.productdetail | isExistFilter:'ProductID':tdetail.ProductID)">
                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="isReadOnly">
                                                    <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID">
                                                        {{pdetail.DisplayName}} </option>
                                                </select>
                                            </td>
                                            <td id="prodDSD" *ngIf="(customer?.productdetail !== null) && !(customer?.productdetail |isExistFilter:'ProductID':tdetail.ProductID)">

                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="true">
                                                    <option [ngValue]="tdetail.ProductID">
                                                        {{tdetail.ProductName}} - {{tdetail.ProductCode}} </option>
                                                </select>
                                            </td>
                                            <!--Alok: Removed currencyFormatter for unit price -->
                                            <td class="textAlignRight">{{tdetail.productSelected?.Price | truncateZero}}</td>
                                            <td class="textAlignRight">
                                                <input type="number" min="1" oninput="validity.valid||(value='');" class="form-control textAlignRight prodListElement" [(ngModel)]="tdetail.Quantity"
                                                    (ngModelChange)="unitChangeHandler(tdetail);isFormDirty=true;" [disabled]="isReadOnly || !tdetail.ProductID">
                                            </td>
                                            <td class="textAlignRight">{{tdetail.totalAmount | currencyFormatter}}</td>
                                            <td class="textAlignCenter" [hidden]="isReadOnly || tdetail.ProductSourceId">
                                                <a href="javascript:void();" (click)="deleteProductHandler(tdetail);isFormDirty=true;">
                                                    <i class="ion-trash-a"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Tax</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{ticket.TaxAmount | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Amount</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{ticket.TotalSale + ticket.TaxAmount | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                        <!-- <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                                <td colspan="2"></td>
                                                <td class="textAlignRight">
                                                    <b>Total Sale</b>
                                                </td>
                                                <td class="textAlignRight">
                                                    <b>{{ticket.TotalSale + ticket.TaxAmount | currencyFormatter}}</b>
                                                </td>
                                                <td [hidden]="isReadOnly"></td>
                                            </tr> -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- DSD Table ends -->

                        <!-- Meter Reading table -->
                        <div class="row" *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket">
                            <div class="col-sm-12">
                                <table class="table table-condensed">
                                    <thead class="mttableHeader">
                                        <th>Machine</th>
                                        <th>Price</th>
                                        <th *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket && ticket.TicketTypeID ==26">Previous Reading</th>
                                        <th *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket && ticket.TicketTypeID ==26">Current Reading</th>
                                        <th *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket && ticket.TicketTypeID ==27">Quantity</th>
                                        <th>Amount</th>
                                        <th class="textAlignCenter" [hidden]="isReadOnly">Action</th>
                                    </thead>
                                    <tbody>
                                        <tr id="prodMR" *ngFor="let tdetail of ticket?.TicketProduct;let i = index">
                                            <td *ngIf="(customer?.productdetail !== null) && (customer?.productdetail | isExistFilter:'ProductID':tdetail.ProductID)">
                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="isReadOnly">
                                                    <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID">
                                                        {{pdetail.DisplayName}} </option>
                                                </select>
                                            </td>
                                            <td *ngIf="(customer?.productdetail !== null) && !(customer?.productdetail |isExistFilter:'ProductID':tdetail.ProductID)">

                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="true">
                                                    <option [ngValue]="tdetail.ProductID">
                                                        {{tdetail.ProductName}} - {{tdetail.ProductCode}} </option>
                                                </select>
                                            </td>
                                            <td>{{tdetail.productSelected?.Price | truncateZero}}</td>
                                            <td *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket && ticket.TicketTypeID ==26">
                                                <input type="number" min="0" oninput="validity.valid||(value='');" minValue class="form-control prodListElement" [(ngModel)]="tdetail.StartMeterReading"
                                                    (ngModelChange)="readingChangeHandler(tdetail);isFormDirty=true;" (blur)="tdetail.EndMeterReading = tdetail.EndMeterReading < tdetail.StartMeterReading?tdetail.StartMeterReading:tdetail.EndMeterReading;readingChangeHandler(tdetail)"
                                                    [disabled]="isReadOnly">
                                            </td>
                                            <td *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket && ticket.TicketTypeID ==26">
                                                <input type="number" min="0" oninput="validity.valid||(value='');" class="form-control prodListElement" [(ngModel)]="tdetail.EndMeterReading"
                                                    (blur)="tdetail.EndMeterReading = tdetail.EndMeterReading < tdetail.StartMeterReading?tdetail.StartMeterReading:tdetail.EndMeterReading;readingChangeHandler(tdetail)"
                                                    (ngModelChange)="readingChangeHandler(tdetail);isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <td *ngIf="ticket.CustomerType == 22 && ticket.IsSaleTicket && ticket.TicketTypeID ==27">
                                                <input type="number" min="1" oninput="validity.valid||(value='');" class="form-control textAlignRight prodListElement" [(ngModel)]="tdetail.Quantity"
                                                    (ngModelChange)="unitChangeHandler(tdetail);isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <td class="textAlignRight">{{tdetail.totalAmount | currencyFormatter}}</td>
                                            <td class="textAlignCenter" [hidden]="isReadOnly || tdetail.ProductSourceId">
                                                <a href="javascript:void();" (click)="deleteProductHandler(tdetail);isFormDirty=true;">
                                                    <i class="ion-trash-a"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Tax</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{tempModels.totalTax | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Amount</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{ticket.TotalSale | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Inventory table -->
                        <div class="row" *ngIf="ticket.CustomerType == 22 && !ticket.IsSaleTicket">
                            <div class="col-sm-12">
                                <table class="table table-condensed">
                                    <thead class="mttableHeader">
                                        <th>Machine</th>
                                        <th>Price</th>
                                        <th>Delivered Bags</th>
                                        <th>Current Inventory</th>
                                        <th>Damaged Bags</th>
                                        <!--<th>Amount</th>-->
                                        <th class="textAlignCenter" [hidden]="isReadOnly">Action</th>
                                    </thead>
                                    <tbody>
                                        <tr id="prodI" *ngFor="let tdetail of ticket?.TicketProduct;let i = index">
                                            <td *ngIf="(customer?.productdetail !== null) && (customer?.productdetail |isExistFilter:'ProductID':tdetail.ProductID)">
                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="isReadOnly">
                                                    <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID">
                                                        {{pdetail.DisplayName}} </option>
                                                </select>
                                            </td>
                                            <td *ngIf="(customer?.productdetail !== null) && !(customer?.productdetail |isExistFilter:'ProductID':tdetail.ProductID)">

                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="true">
                                                    <option [ngValue]="tdetail.ProductID">
                                                        {{tdetail.ProductName}} - {{tdetail.ProductCode}} </option>
                                                </select>
                                            </td>
                                            <td class="textAlignRight"> {{tdetail.productSelected?.Price | truncateZero}}</td>
                                            <td>
                                                <input maxlength="9" numberOnly oninput="validity.valid||(value='');" class="form-control prodListElement" [(ngModel)]="tdetail.DeliveredBags"
                                                    (ngModelChange)="bagsChangeHandler(tdetail);isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <td>
                                                <input maxlength="9" numberOnly oninput="validity.valid||(value='');" class="form-control prodListElement" [(ngModel)]="tdetail.CurrentInventory"
                                                    (ngModelChange)="isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <td>
                                                <input maxlength="9" numberOnly oninput="validity.valid||(value='');" class="form-control prodListElement" [(ngModel)]="tdetail.DamagedBags"
                                                    (ngModelChange)="isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <!--<td class="textAlignRight">{{tdetail.totalAmount | currencyFormatter}}</td>-->
                                            <td class="textAlignCenter" [hidden]="isReadOnly || tdetail.ProductSourceId">
                                                <a href="javascript:void();" (click)="deleteProductHandler(tdetail);isFormDirty=true;">
                                                    <i class="ion-trash-a"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <!-- <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="3"></td>
                                            <td class="textAlignRight">
                                                <b>Total Tax</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{tempModels.totalTax | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="3"></td>
                                            <td class="textAlignRight">
                                                <b>Total Amount</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{ticket.TotalSale | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>-->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- PBM Table ends -->

                        <!-- PBS Table begins -->
                        <div class="row" *ngIf="ticket.CustomerType == 21">
                            <div class="col-sm-12">
                                <table class="table table-condensed">
                                    <thead class="mttableHeader">
                                        <th>Product</th>
                                        <th>Price</th>
                                        <th>Current Inventory</th>
                                        <th>Delivered Bags</th>
                                        <th>Amount</th>
                                        <th class="textAlignCenter" [hidden]="isReadOnly">Action</th>
                                    </thead>
                                    <tbody>
                                        <tr id="prodPBS" *ngFor="let tdetail of ticket?.TicketProduct;let i = index">
                                            <td *ngIf="(customer?.productdetail !== null) && (customer?.productdetail |isExistFilter:'ProductID':tdetail.ProductID)">
                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="isReadOnly">
                                                    <option *ngFor="let pdetail of customer?.productdetail" [ngValue]="pdetail.ProductID">
                                                        {{pdetail.DisplayName}} </option>
                                                </select>
                                            </td>
                                            <td *ngIf="(customer?.productdetail !== null) && !(customer?.productdetail |isExistFilter:'ProductID':tdetail.ProductID)">

                                                <select class="form-control prodListElement" name="product" [(ngModel)]="tdetail.ProductID" (ngModelChange)="productChangeHandler(tdetail,i)"
                                                    [disabled]="true">
                                                    <option [ngValue]="tdetail.ProductID">
                                                        {{tdetail.ProductName}} - {{tdetail.ProductCode}} </option>
                                                </select>
                                            </td>
                                            <td>{{tdetail.productSelected?.Price | truncateZero}}</td>
                                            <td>
                                                <input maxlength="9" numberOnly oninput="validity.valid||(value='');" class="form-control prodListElement" [(ngModel)]="tdetail.CurrentInventory"
                                                    (ngModelChange)="unitChangeHandler(tdetail);isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <td>
                                                <input maxlength="9" numberOnly oninput="validity.valid||(value='');" class="form-control prodListElement" [(ngModel)]="tdetail.Quantity"
                                                    (ngModelChange)="unitChangeHandler(tdetail);isFormDirty=true;" [disabled]="isReadOnly">
                                            </td>
                                            <td class="textAlignRight">{{tdetail.totalAmount | currencyFormatter}}</td>
                                            <td class="textAlignCenter" [hidden]="isReadOnly || tdetail.ProductSourceId">
                                                <a href="javascript:void();" (click)="deleteProductHandler(tdetail);isFormDirty=true;">
                                                    <i class="ion-trash-a"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Tax</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{tempModels.totalTax | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Amount</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{ticket.TotalSale | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                        <tr [hidden]="!ticket.TicketProduct || !ticket.TicketProduct.length">
                                            <td colspan="2"></td>
                                            <td class="textAlignRight">
                                                <b>Total Sale</b>
                                            </td>
                                            <td class="textAlignRight">
                                                <b>{{ticket.TotalSale | currencyFormatter}}</b>
                                            </td>
                                            <td [hidden]="isReadOnly"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- PBS Table ends -->
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-2 border cashPanel padding cashPanelMargin">
            <div class="padding">
                <label for="example-text-input" class="col-form-label">Cash Amount($)</label>
                <input type="text" [numberOnly]="true" id="number" min="0" class="form-control" [(ngModel)]="ticket.CashAmount" placeholder="Cash Amount"
                    (blur)="cashAmountChangeHandler()" [disabled]="ticket.TicketTypeID == 27 || ticket.CustomerType == 21 || !ticket.IsSaleTicket || isReadOnly"
                    (ngModelChange)="isFormDirty=true;">
            </div>
            <div id="checkNumber" class="padding">
                <label for="example-text-input" class="col-form-label">Check#</label>
                <input type="text" class="form-control" alphaNumeric [(ngModel)]="ticket.CheckNumber" placeholder="Check Number" (blur)="checkNumberChangeHandler()"
                    (ngModelChange)="isFormDirty=true;" name="CheckNumber" #CheckNumber="ngModel" required [disabled]="ticket.TicketTypeID == 27 || ticket.CustomerType == 21 || !ticket.IsSaleTicket || isReadOnly">
                <!-- <div *ngIf="ticket.CheckAmount && !ticket.CheckNumber && (CheckNumber.dirty || CheckNumber.touched)" class="error-message">
                    <i class="ion-android-alert showError"></i>
                    <div *ngIf="ticket.CheckAmount && !ticket.CheckNumber" class="custom-tooltip bottom">Check number is required as Check Amount exists</div>
                </div> -->
                <!-- <div *ngIf="checkMinMaxLength" class="error-message">
                    <i class="ion-android-alert showError"></i>
                    <div class="custom-tooltip bottom">Should be 5 to 20 digits long</div>
                </div>                 -->
            </div>
            <div id="checkAmount" class="padding">
                <label for="example-text-input" class="col-form-label">Check Amount($)</label>
                <input type="text" [numberOnly]="true" min="0" class="form-control" [(ngModel)]="ticket.CheckAmount" placeholder="Check Amount"
                    [disabled]="ticket.TicketTypeID == 27 || ticket.CustomerType == 21 || !ticket.IsSaleTicket || isReadOnly"
                    name="CheckAmount" #CheckAmount="ngModel" required (blur)="checkAmountChangeHandler()" (ngModelChange)="isFormDirty=true;">
                <!-- <div *ngIf="ticket.CheckNumber && !ticket.CheckAmount && (CheckAmount.dirty || CheckAmount.touched)" class="error-message">
                    <i class="ion-android-alert showError"></i>
                    <div *ngIf="ticket.CheckNumber && !ticket.CheckAmount" class="custom-tooltip bottom">Check Amount is required as Check Number exists</div>
                </div> -->
            </div>
        </div>
    </div>
</ba-card>